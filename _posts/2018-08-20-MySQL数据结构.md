---
layout: post
title:   MySQL数据结构
categories: 数据库
description: SQL数据结构
keywords: 
---

## MySQL数据结构

### 一、MySQL 索引

1.索引的优点

   ①大大减少了服务器需要扫描的数据行数。

   ②帮助服务器避免进行排序和分组，也就不需要创建临时表（B+Tree 索引是有序的，可以用于 ORDER BY 和 GROUP BY 操作。临时表主要是在排序和分组过程中创建，因为不需要排序和分组，也就不需要创建临时表）。

  ③将随机 I/O 变为顺序 I/O（B+Tree 索引是有序的，也就将相邻的数据都存储在一起）。

2.索引的使用场景

  ①对于非常小的表、大部分情况下简单的全表扫描比建立索引更高效。
  ②对于中到大型的表，索引就非常有效。
  ③但是对于特大型的表，建立和维护索引的代价将会随之增长。这种情况下，需要用到一种技术可以直接区分出需要查询的一组数据，而不是一条记录一条记录地匹配，例如可以使用分区技术。

3.索引是在存储引擎层实现的，而不是在服务器层实现的，所以不同存储引擎具有不同的索引类型和实现。

3.1.B+Tree 索引

①大多数 MySQL 存储引擎的默认索引类型。因为不再需要进行全表扫描，只需要对树进行搜索即可，因此查找速度快很多。除了用于查找，还可以用于排序和分组。

②主索引的叶子节点 data 域记录着完整的数据记录，这种索引方式被称为聚簇索引。因为无法把数据行存放在两个不同的地方，所以一个表只能有一个聚簇索引；辅助索引的叶子节点的 data 域记录着主键的值，因此在使用辅助索引进行查找时，需要先查找到主键值，然后再到主索引中进行查找。

3.2.哈希索引

哈希索引能以 O(1) 时间进行查找，但是失去了有序性，它具有以下限制：

​    ①无法用于排序与分组；
    ②只支持精确查找，无法用于部分查找和范围查找。
InnoDB 存储引擎有一个特殊的功能叫“自适应哈希索引”，当某个索引值被使用的非常频繁时，会在 B+Tree 索引之上再创建一个哈希索引，这样就让 B+Tree 索引具有哈希索引的一些优点，比如快速的哈希查找。

3.3.全文索引

MyISAM 存储引擎支持全文索引，用于查找文本中的关键词，而不是直接比较是否相等。查找条件使用 MATCH AGAINST，而不是普通的 WHERE。全文索引一般使用倒排索引实现，它记录着关键词到其所在文档的映射。

### 二、索引优化

1.查询性能优化

①Explain 用来分析 SELECT 查询语句，进而优化，比较重要的字段有：

select_type : 查询类型，有简单查询、联合查询、子查询等
key : 使用的索引
rows : 扫描的行数

2.优化数据访问

①减少请求的数据量

②减少服务器端扫描的行数

3.重构查询方式

①切分大查询

②分解大连接

### 三、存储引擎

1.InnoDB

是 MySQL 默认的事务型存储引擎。

实现了四个标准的隔离级别，默认级别是可重复读（REPEATABLE READ）。在可重复读隔离级别下，通过多版本并发控制（MVCC）+ 间隙锁（Next-Key Locking）防止幻影读。

主索引是聚簇索引，在索引中保存了数据，从而避免直接读取磁盘，因此对查询性能有很大的提升。

InnoDB 支持外键。 

2.MyISAM

设计简单，数据以紧密格式存储。对于只读数据，或者表比较小、可以容忍修复操作，则依然可以使用它。 不支持事务 。

MyISAM 支持压缩表和空间数据索引 

MyISAM 崩溃后发生损坏的概率比 InnoDB 高很多，而且恢复的速度也更慢。 

### 四、切分

1.水平切分

水平切分又称为 Sharding，它是将同一个表中的记录拆分到多个结构相同的表中。ID唯一。

当一个表的数据不断增多时，Sharding 是必然的选择，它可以将数据分布到集群的不同节点上，从而缓存单个数据库的压力。

2.垂直切分

垂直切分是将一张表按列切分成多个表，通常是按照列的关系密集程度进行切分，也可以利用垂直切分将经常被使用的列和不经常被使用的列切分到不同的表中。

### 五、复制

1.主从复制

主要涉及三个线程：binlog 线程、I/O 线程和 SQL 线程。

- binlog 线程 ：负责将主服务器上的数据更改写入二进制日志中。
- I/O 线程 ：负责从主服务器上读取二进制日志，并写入从服务器的中继日志中。
- SQL 线程 ：负责读取中继日志并重放其中的 SQL 语句。

2.读写分离

主服务器处理写操作以及实时性要求比较高的读操作，而从服务器处理读操作。 