---
layout: post
title:   B-树和B+树
categories: 数据库
description: B-树和B+树
keywords: 
---



引言：

数据库中的索引是基于B-树或者B+树，B-树主要应用于文件系统以及部分数据库索引，比如MongoDB，而大部分的关系型数据库，则使用B+树作为索引

# 一、B-树

## 1.二叉查找树和B-树

数据库索引采用树结构存储是因为，树的查询效率高，而且可以保持有序。二叉查找树的查找个比较次数都比较小，但是要考虑到磁盘IO。

数据库索引是存放在磁盘上的，当数据库的量比较大时，索引的大小可能有几个G甚至更多，我们利用索引查询的时候，只能注意家在每一个磁盘页，这里的磁盘也对应着树的节点。磁盘IO数由树的高度决定。为了减少磁盘IO的次数，需要把园那里“瘦高”的二叉搜索树变得“矮胖”->符合B-树的特征。

## 2.m阶的B树（Balance Tree）特征

1.B-树是一个多路平衡查找树，每一个节点最多包含m个孩子，其中m叫做B树的阶，m的大小取决于磁盘页的大小

2.根节点至少有两个子女

3.每个中间节点都包含k-1个元素和k个孩子，其中m/2<=k<=m

4.每一个叶子节点包含k-1个元素

5.所有叶子节点位于同一层

6.每个节点的元素从大到小排列，节点当中k-1个元素正好是k个孩子包含的元素的值域划分

![1523091653607](C:\Users\ADMINI~1\AppData\Local\Temp\1523091653607.png)

## 3.B树查询

同二叉查找树类似，从上到下进行查询。

B树的查询不比二叉查找树少，尤其是当单一节点的元素数量比较多的时候，但是相比于硬盘IO的速度，内存的耗时可以忽略，只要树的高度足够低，IO次数足够少就可以提升查找性能，节点元素比较多也只是多了几次内存交互

B树查询时间短

## 4.B树插入

二叉树的插入过程比较复杂，以典型的要插入的元素位于同一节点的几个元素之间，要保证节点元素书不超过m-1，于是从父节点开始，向上寻找单元素节点，升级为两元素节点，中途经过的多元素节点要拆分成为他父节点的独立的孩子。

B树始终能够维持多路平衡：自平衡

## 5.B树删除

B树的删除也比较麻烦，据一个典型的例子，删除一个元素之后，父节点失去了一个孩子，这时候要找父节点和剩下的孩子之间的中位数作为新的父节点。

# 二、B+树

## 1.m阶的B+树特征

1.有k个子树的中间节点包含有k个元素（B树中是k-1个元素），每个元素不保存数据，只用来索引，所有数据都保存在叶子节点。

2.所有的叶子结点中包含了全部元素的信息，及指向含这些元素记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。

3.所有的中间节点元素都同时存在于子节点，在子节点元素中是最大（或最小）元素。

![1523093271948](C:\Users\ADMINI~1\AppData\Local\Temp\1523093271948.png)

根节点的最大元素，也就等同于整个B+树的最大元素，无论之后插入多少元素，始终要保持最大元素在根节点中。

所有叶子节点包含了全量元素信息，每一个叶子姐带你都带有指向下一个节点的指针，形成了一个有序链表

## 2.B+树的特点

1.卫星数据的位置

卫星数据是指，索引元素所指向的数据记录，比如数据库中的某一行，在B树中，无论中间节点合适叶子节点都带有卫星数据；但是在B+树中，只有叶子节点带有卫星数据，其余中间节点只是索引，没有任何数据关联。

在数据库的聚集索引（Clustered Index）中，叶子节点直接包含卫星数据。在非聚集索引（NonClustered Index）中，叶子节点带有指向卫星数据的指针。



## 3.B+树的查询

1.B+树的中间节点没有卫星数据，所以同样大小的磁盘页可以容纳更多的节点元素，也就是说，在数据量相同的情况下，B+树比B-树更加“矮胖”

2.B+树查找必须最终查找到叶子节点，B-树只要找到匹配的元素就完成查找，因此B+树的查找性能是稳定的，而B-树的查找性能是不稳定的

3.对于范围查找来说，B-树依靠繁琐的中序遍历，B+树只需要在链表上进行遍历即可。