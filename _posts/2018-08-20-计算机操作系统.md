---
layout: post
title:   操作系统原理
categories: 操作系统
description: 操作系统原理
keywords: 
---

## 操作系统原理

### 一、基本概念

1.并发：并发是指宏观上在一段时间内能同时运行多个程序 

2.并行：并行则指同一时刻能运行多个指令。并行需要硬件支持，如多流水线或者多处理器。操作系统通过引入进程和线程，使得程序能够并发运行。 

3.共享：共享是指系统中的资源可以被多个并发进程共同使用。 有两种共享方式：互斥共享和同时共享。 

4.虚拟：把一个物理实体转换为多个逻辑实体。 主要有两种虚拟技术：时分复用技术和空分复用技术。

5.异步:异步指进程不是一次性执行完毕，而是走走停停，以不可知的速度向前推进。

6中断分类：

①外中断：由 CPU 执行指令以外的事件引起，如 I/O 完成中断，表示设备输入/输出处理已经完成，处理器能够发送下一个输入/输出请求。此外还有时钟中断、控制台中断等。

②异常：由 CPU 执行指令的内部事件引起，如非法操作码、地址越界、算术溢出等。

③陷入：在用户程序中使用系统调用

### 二、进程管理

1.进程和线程的区别

①拥有资源

进程是资源分配的基本单位，但是线程不拥有资源，线程可以访问隶属进程的资源。

②调度

线程是独立调度的基本单位，在同一进程中，线程的切换不会引起进程切换，从一个进程内的线程切换到另一个进程中的线程时，会引起进程切换。

③系统开销

由于创建或撤销进程时，系统都要为之分配或回收资源，如内存空间、I/O 设备等，所付出的开销远大于创建或撤销线程时的开销。类似地，在进行进程切换时，涉及当前执行进程 CPU 环境的保存及新调度进程 CPU 环境的设置，而线程切换时只需保存和设置少量寄存器内容，开销很小。

④通信方面

进程间通信 (IPC) 需要进程同步和互斥手段的辅助，以保证数据的一致性。而线程间可以通过直接读/写同一进程中的数据段（如全局变量）来进行通信。

2.进程状态的切换

就绪状态（ready）：等待被调度

运行状态（running）

阻塞状态（waiting）：等待资源

①只有就绪态和运行态可以相互转换，其它的都是单向转换。就绪状态的进程通过调度算法从而获得 CPU 时间，转为运行状态；而运行状态的进程，在分配给它的 CPU 时间片用完之后就会转为就绪状态，等待下一次调度。

②阻塞状态是缺少需要的资源从而由运行状态转换而来

3进程调度算法

第一类：批处理系统（没有太多用户操作。保证吞吐量和周转时间）

①先来先服务

②短作业优先

③最短剩余时间优先

第二类：交互式系统（大量用户操作，保证快速响应）

①时间片轮转

②优先级调度

③多级反馈队列

第三类：实时系统（要求一个请求在确定的时间内得到响应）

4.进程同步

①临界区：对临界资源进行访问的那段代码称为临界区。

②同步和互斥：同步：多个进程按一定顺序执行；互斥：多个进程在同一时刻只有一个进程能进入临界区。

③信号量：信号量（Semaphore）是一个整型变量，可以对其执行 down 和 up 操作，也就是常见的 P 和 V 操作。

down : 如果信号量大于 0 ，执行 -1 操作；如果信号量等于 0，进程睡眠，等待信号量大于 0；
up ：对信号量执行 +1 操作，唤醒睡眠的进程让其完成 down 操作。

down 和 up 操作需要被设计成原语，不可分割，通常的做法是在执行这些操作的时候屏蔽中断。 

如果信号量的取值只能为 0 或者 1，那么就成为了 **互斥量（Mutex）** ，0 表示临界区已经加锁，1 表示临界区解锁。 

④管程：把控制的代码独立出来 ，引入了 条件变量 以及相关的操作：wait() 和 signal() 来实现同步操作。对条件变量执行 wait() 操作会导致调用进程阻塞，把管程让出来给另一个进程持有。signal() 操作用于唤醒被阻塞的进程。

5.进程通信

进程同步：控制多个进程按一定顺序执行；
进程通信：进程间传输信息。

①管道：管道是通过调用 pipe 函数创建的，fd[0] 用于读，fd[1] 用于写。

只支持半双工通信（单向交替传输）；
只能在父子进程中使用。

②命名管道：去除了管道只能在父子进程中使用的限制。

③消息队列：相比于 FIFO，消息队列具有以下优点：

消息队列可以独立于读写进程存在，从而避免了 FIFO 中同步管道的打开和关闭时可能产生的困难；
避免了 FIFO 的同步阻塞问题，不需要进程自己提供同步方法；
读进程可以根据消息类型有选择地接收消息，而不像 FIFO 那样只能默认地接收。

④信号量：一个计数器，用于为多个进程提供对共享数据对象的访问。

⑤共享内存：允许多个进程共享一个给定的存储区。因为数据不需要在进程之间复制，所以这是最快的一种 IPC。共享内存不是使用文件，而是使用使用内存的匿名段。

⑥套接字：可用于不同机器间的进程通信。

### 三、死锁

1.死锁的必要条件：

互斥：每个资源要么已经分配给了一个进程，要么就是可用的。
占有和等待：已经得到了某个资源的进程可以再请求新的资源。
不可抢占：已经分配给一个进程的资源不能强制性地被抢占，它只能被占有它的进程显式地释放。
环路等待：有两个或者两个以上的进程组成一条环路，该环路中的每个进程都在等待下一个进程所占有的资源

2.思索的处理方法

1.鸵鸟策略

2.死锁检测与死锁恢复

①每种类型一个资源的死锁检测 ：是通过检测有向图是否存在环来实现，从一个节点出发进行深度优先搜索，对访问过的节点进行标记，如果访问了已经标记的节点，就表示有向图存在环，也就是检测到死锁的发生。 

②每种类型多个资源：每个进程最开始时都不被标记，执行过程有可能被标记。当算法结束时，任何没有被标记的进程都是死锁进程。

③死锁恢复：抢占、回滚、杀死进程

3.死锁预防

（一）破坏互斥条件

例如假脱机打印机技术允许若干个进程同时输出，唯一真正请求物理打印机的进程是打印机守护进程。

（二）破坏占有和等待条件

一种实现方式是规定所有进程在开始执行前请求所需要的全部资源。

（三）破坏不可抢占条件

（四）破坏环路等待：给资源统一编号，进程只能按编号顺序来请求资源 

4.死锁避免（银行家算法）

### 四、内存管理

1.分页：虚拟内存采用的是分页技术，也就是将地址空间划分成固定大小的页，每一页再与内存进行映射。

分页置换算法，页面置换算法的主要目标是使页面置换频率最低（也可以说缺页率最低） ：

最佳、最近最久未被使用、最近未被使用、先进先出、第二次机会。时钟。

2.分段：分段的做法是把每个表分成段，一个段构成一个独立的地址空间。每个段的长度可以不同，并且可以动态增长

3.分页与分段的比较：

对程序员的透明性：分页透明，但是分段需要程序员显示划分每个段。

地址空间的维度：分页是一维地址空间，分段是二维的。

大小是否可以改变：页的大小不可变，段的大小可以动态改变。

出现的原因：分页主要用于实现虚拟内存，从而获得更大的地址空间；分段主要是为了使程序和数据可以被划分为逻辑上独立的地址空间并且有助于共享和保护。

4.磁盘调度算法

读写一个磁盘块的时间的影响因素有：

旋转时间（主轴转动盘面，使得磁头移动到适当的扇区上）
寻道时间（制动手臂移动，使得磁头移动到适当的磁道上）
实际的数据传输时间
其中，寻道时间最长，因此磁盘调度的主要目标是使磁盘的平均寻道时间最短。

①先来先服务

②最短寻道时间优先

③电梯算法

